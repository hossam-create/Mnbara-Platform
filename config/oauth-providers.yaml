# OAuth Providers Configuration
# Mnbara Platform - Production OAuth Setup
# Status: FINAL 5% COMPLETION

apiVersion: v1
kind: ConfigMap
metadata:
  name: oauth-config
  namespace: mnbara-production
data:
  # Google OAuth Configuration
  google-oauth.json: |
    {
      "web": {
        "client_id": "${GOOGLE_CLIENT_ID}",
        "project_id": "mnbara-platform",
        "auth_uri": "https://accounts.google.com/o/oauth2/auth",
        "token_uri": "https://oauth2.googleapis.com/token",
        "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
        "client_secret": "${GOOGLE_CLIENT_SECRET}",
        "redirect_uris": [
          "https://mnbara.com/auth/google/callback",
          "https://api.mnbara.com/auth/google/callback"
        ],
        "javascript_origins": [
          "https://mnbara.com",
          "https://www.mnbara.com"
        ]
      }
    }

  # Facebook OAuth Configuration
  facebook-oauth.json: |
    {
      "app_id": "${FACEBOOK_CLIENT_ID}",
      "app_secret": "${FACEBOOK_CLIENT_SECRET}",
      "redirect_uri": "https://mnbara.com/auth/facebook/callback",
      "scope": "email,public_profile",
      "auth_url": "https://www.facebook.com/v18.0/dialog/oauth",
      "token_url": "https://graph.facebook.com/v18.0/oauth/access_token",
      "user_info_url": "https://graph.facebook.com/v18.0/me?fields=id,name,email,picture"
    }

  # Apple OAuth Configuration
  apple-oauth.json: |
    {
      "client_id": "${APPLE_CLIENT_ID}",
      "team_id": "${APPLE_TEAM_ID}",
      "key_id": "${APPLE_KEY_ID}",
      "private_key": "${APPLE_PRIVATE_KEY}",
      "redirect_uri": "https://mnbara.com/auth/apple/callback",
      "scope": "name email",
      "auth_url": "https://appleid.apple.com/auth/authorize",
      "token_url": "https://appleid.apple.com/auth/token",
      "response_type": "code",
      "response_mode": "form_post"
    }

---
# OAuth Provider Setup Instructions
apiVersion: v1
kind: ConfigMap
metadata:
  name: oauth-setup-instructions
  namespace: mnbara-production
data:
  setup-instructions.md: |
    # OAuth Providers Setup Instructions
    
    ## Google OAuth Setup
    1. Go to Google Cloud Console (https://console.cloud.google.com/)
    2. Create a new project or select existing "mnbara-platform"
    3. Enable Google+ API and Google OAuth2 API
    4. Go to Credentials → Create Credentials → OAuth 2.0 Client IDs
    5. Set Application Type to "Web application"
    6. Add Authorized JavaScript origins:
       - https://mnbara.com
       - https://www.mnbara.com
    7. Add Authorized redirect URIs:
       - https://mnbara.com/auth/google/callback
       - https://api.mnbara.com/auth/google/callback
    8. Copy Client ID and Client Secret to secrets
    
    ## Facebook OAuth Setup
    1. Go to Facebook Developers (https://developers.facebook.com/)
    2. Create a new app or use existing "Mnbara Platform"
    3. Add Facebook Login product
    4. Set Valid OAuth Redirect URIs:
       - https://mnbara.com/auth/facebook/callback
    5. Set App Domains: mnbara.com
    6. Copy App ID and App Secret to secrets
    
    ## Apple OAuth Setup
    1. Go to Apple Developer Console (https://developer.apple.com/)
    2. Create App ID with Sign In with Apple capability
    3. Create Service ID for web authentication
    4. Set Return URLs:
       - https://mnbara.com/auth/apple/callback
    5. Create private key for Sign In with Apple
    6. Copy Team ID, Key ID, Client ID, and Private Key to secrets
    
    ## Environment Variables Required
    ```bash
    # Google OAuth
    GOOGLE_CLIENT_ID=your_google_client_id
    GOOGLE_CLIENT_SECRET=your_google_client_secret
    
    # Facebook OAuth
    FACEBOOK_CLIENT_ID=your_facebook_app_id
    FACEBOOK_CLIENT_SECRET=your_facebook_app_secret
    
    # Apple OAuth
    APPLE_CLIENT_ID=your_apple_service_id
    APPLE_TEAM_ID=your_apple_team_id
    APPLE_KEY_ID=your_apple_key_id
    APPLE_PRIVATE_KEY=your_apple_private_key
    ```
    
    ## Testing OAuth Integration
    1. Test Google login: https://mnbara.com/login?provider=google
    2. Test Facebook login: https://mnbara.com/login?provider=facebook
    3. Test Apple login: https://mnbara.com/login?provider=apple
    
    ## Security Considerations
    - All OAuth callbacks use HTTPS
    - Client secrets are stored in Kubernetes secrets
    - Redirect URIs are whitelisted
    - Scope is limited to necessary permissions only
    - Token validation includes issuer verification

---
# OAuth Secrets Template
apiVersion: v1
kind: Secret
metadata:
  name: oauth-secrets
  namespace: mnbara-production
type: Opaque
stringData:
  # Google OAuth Credentials
  GOOGLE_CLIENT_ID: "your-google-client-id.apps.googleusercontent.com"
  GOOGLE_CLIENT_SECRET: "your-google-client-secret"
  
  # Facebook OAuth Credentials
  FACEBOOK_CLIENT_ID: "your-facebook-app-id"
  FACEBOOK_CLIENT_SECRET: "your-facebook-app-secret"
  
  # Apple OAuth Credentials
  APPLE_CLIENT_ID: "com.mnbara.platform"
  APPLE_TEAM_ID: "your-apple-team-id"
  APPLE_KEY_ID: "your-apple-key-id"
  APPLE_PRIVATE_KEY: |
    -----BEGIN PRIVATE KEY-----
    your-apple-private-key-content
    -----END PRIVATE KEY-----