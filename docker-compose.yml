# Mnbara Platform - Unified Infrastructure Setup
version: '3.8'

services:
  # ===================
  # DATABASES & INFRA
  # ===================
  
  postgres:
    image: postgres:15-alpine
    container_name: mnbara-postgres
    environment:
      POSTGRES_DB: mnbara
      POSTGRES_USER: mnbara
      POSTGRES_PASSWORD: mnbara_dev_password
      POSTGRES_MULTIPLE_DATABASES: auth_db,listing_db,payment_db,orders_db,auction_db,crowdship_db,notification_db,matching_db,trips_db,recommendation_db,rewards_db,signal_db,ai_db,compliance_db,settlement_db,bnpl_db,crypto_db,wallet_db,escrow_db,paypal_db,ai_assistant_db,mnbara_ai_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./scripts/init-multiple-databases.sh:/docker-entrypoint-initdb.d/init-multiple-databases.sh
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U mnbara"]
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    container_name: mnbara-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: mnbara-rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: mnbara
      RABBITMQ_DEFAULT_PASS: mnbara_dev_password
    ports:
      - "5672:5672"
      - "15672:15672"
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "rabbitmq-diagnostics", "ping"]
      interval: 30s
      timeout: 10s
      retries: 5

  elasticsearch:
    image: elasticsearch:8.11.0
    container_name: mnbara-elasticsearch
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    ports:
      - "9200:9200"
    volumes:
      - elasticsearch_data:/usr/share/elasticsearch/data
    networks:
      - mnbara-network

  # ===================
  # CORE SERVICES
  # ===================

  api-gateway:
    build:
      context: ./backend/services/api-gateway
      dockerfile: Dockerfile
    container_name: mnbara-api-gateway
    ports:
      - "8080:8080"
    environment:
      - NODE_ENV=development
      - PORT=8080
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis
    networks:
      - mnbara-network

  # Auth Service (Java/Spring Boot) - eBay-Level Security
  auth-service-java:
    build:
      context: ./backend/services/auth-service-java
      dockerfile: Dockerfile
    container_name: mnbara-auth-service-java
    ports:
      - "3001:3001"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - SERVER_PORT=3001
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_NAME=auth_db
      - DB_USER=mnbara
      - DB_PASSWORD=mnbara_dev_password
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
      - JWT_REFRESH_SECRET=your-super-secret-refresh-key-change-in-production-256-bit-key-for-security
      - GOOGLE_CLIENT_ID=your-google-client-id
      - GOOGLE_CLIENT_SECRET=your-google-client-secret
      - FACEBOOK_CLIENT_ID=your-facebook-client-id
      - FACEBOOK_CLIENT_SECRET=your-facebook-client-secret
      - APPLE_CLIENT_ID=your-apple-client-id
      - APPLE_CLIENT_SECRET=your-apple-client-secret
      - ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    volumes:
      - ./backend/services/auth-service-java:/app
      - /app/target
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3001/api/auth/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # Listing Service (Node.js + Elasticsearch) - eBay-Level Product Catalog
  listing-service-node:
    build:
      context: ./backend/services/listing-service-node
      dockerfile: Dockerfile
    container_name: mnbara-listing-service-node
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=docker
      - PORT=3002
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/listing_db
      - ELASTICSEARCH_URL=http://elasticsearch:9200
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - RABBITMQ_URL=amqp://mnbara:mnbara_dev_password@rabbitmq:5672
      - AUTH_SERVICE_URL=http://auth-service-java:3001
      - ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
      - IMAGE_UPLOAD_PATH=/app/uploads
      - MAX_FILE_SIZE=10485760
      - ELASTICSEARCH_USERNAME=elastic
      - ELASTICSEARCH_PASSWORD=changeme
    depends_on:
      - postgres
      - elasticsearch
      - redis
      - rabbitmq
    networks:
      - mnbara-network
    volumes:
      - ./backend/services/listing-service-node:/app
      - /app/node_modules
      - /app/dist
      - listing_uploads:/app/uploads
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3002/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # Auth Service (Legacy Node.js)
  auth-service:
    build:
      context: ./backend/services/auth-service
      dockerfile: Dockerfile
    container_name: mnbara-auth-service
    environment:
      - NODE_ENV=development
      - PORT=3001
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/auth_db
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=your-super-secret-jwt-key
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network

  # Listing Service (Legacy Node.js)
  listing-service:
    build:
      context: ./backend/services/listing-service
      dockerfile: Dockerfile
    container_name: mnbara-listing-service
    environment:
      - NODE_ENV=development
      - PORT=3002
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/listing_db
      - REDIS_URL=redis://redis:6379
      - ELASTICSEARCH_URL=http://elasticsearch:9200
    depends_on:
      - postgres
      - redis
      - elasticsearch
    networks:
      - mnbara-network

  payment-service:
    build:
      context: ./backend/services/payment-service
      dockerfile: Dockerfile
    container_name: mnbara-payment-service
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=development
      - PORT=3002
      - CORS_ORIGIN=http://localhost:3000
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY:-sk_test_your_stripe_secret_key}
      - STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET:-whsec_your_webhook_secret}
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3002/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  orders-service:
    build:
      context: ./backend/services/order-service
      dockerfile: Dockerfile
    container_name: mnbara-orders-service
    ports:
      - "3003:3003"
    environment:
      - NODE_ENV=development
      - PORT=3003
      - CORS_ORIGIN=http://localhost:3000
      - AUTH_SERVICE_URL=http://auth-service-java:3001
      - PAYMENT_SERVICE_URL=http://payment-service:3002
      - LISTING_SERVICE_URL=http://listing-service-node:3002
    depends_on:
      - postgres
      - redis
      - auth-service-java
      - payment-service
      - listing-service-node
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3003/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  auction-service:
    build:
      context: ./backend/services/auction-service
      dockerfile: Dockerfile
    container_name: mnbara-auction-service
    environment:
      - NODE_ENV=development
      - PORT=3005
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/auction_db
      - REDIS_URL=redis://redis:6379
      - RABBITMQ_URL=amqp://mnbara:mnbara_dev_password@rabbitmq:5672
    depends_on:
      - postgres
      - redis
      - rabbitmq
    networks:
      - mnbara-network

  crowdship-service:
    build:
      context: ./backend/services/crowdship-service
      dockerfile: Dockerfile
    container_name: mnbara-crowdship-service
    environment:
      - NODE_ENV=development
      - PORT=3006
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/crowdship_db
      - REDIS_URL=redis://redis:6379
      - RABBITMQ_URL=amqp://mnbara:mnbara_dev_password@rabbitmq:5672
    depends_on:
      - postgres
      - redis
      - rabbitmq
    networks:
      - mnbara-network

  notification-service:
    build:
      context: ./backend/services/notification-service
      dockerfile: Dockerfile
    container_name: mnbara-notification-service
    ports:
      - "3004:3004"
      - "8080:8080"
    environment:
      - NODE_ENV=development
      - PORT=3004
      - CORS_ORIGIN=http://localhost:3000
      - SMTP_HOST=${SMTP_HOST:-smtp.gmail.com}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3004/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ===================
  # SPECIALIZED SERVICES
  # ===================

  matching-service:
    build:
      context: ./backend/services/matching-service
      dockerfile: Dockerfile
    container_name: mnbara-matching-service
    environment:
      - NODE_ENV=development
      - PORT=3010
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/matching_db
      - REDIS_URL=redis://redis:6379
      - RABBITMQ_URL=amqp://mnbara:mnbara_dev_password@rabbitmq:5672
    depends_on:
      - postgres
      - redis
      - rabbitmq
    networks:
      - mnbara-network

  trips-service:
    build:
      context: ./backend/services/trips-service
      dockerfile: Dockerfile
    container_name: mnbara-trips-service
    environment:
      - NODE_ENV=development
      - PORT=3011
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/trips_db
      - REDIS_URL=redis://redis:6379
      - RABBITMQ_URL=amqp://mnbara:mnbara_dev_password@rabbitmq:5672
    depends_on:
      - postgres
      - redis
      - rabbitmq
    networks:
      - mnbara-network

  recommendation-service:
    build:
      context: ./backend/services/recommendation-service
      dockerfile: Dockerfile
    container_name: mnbara-recommendation-service
    environment:
      - ENVIRONMENT=development
      - PORT=3012
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/recommendation_db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network

  rewards-service:
    build:
      context: ./backend/services/rewards-service
      dockerfile: Dockerfile
    container_name: mnbara-rewards-service
    environment:
      - NODE_ENV=development
      - PORT=3013
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/rewards_db
      - REDIS_URL=redis://redis:6379
      - RABBITMQ_URL=amqp://mnbara:mnbara_dev_password@rabbitmq:5672
    depends_on:
      - postgres
      - redis
      - rabbitmq
    networks:
      - mnbara-network

  signal-aggregation-service:
    build:
      context: ./backend/services/signal-aggregation-service
      dockerfile: Dockerfile
    container_name: mnbara-signal-aggregation-service
    environment:
      - NODE_ENV=development
      - PORT=3014
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/signal_db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network

  ai-core:
    build:
      context: ./backend/services/ai-core
      dockerfile: Dockerfile
    container_name: mnbara-ai-core
    environment:
      - ENVIRONMENT=development
      - PORT=3007
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/ai_db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network

  # Compliance Service - Customs Warnings & Prohibited Items
  compliance-service:
    build:
      context: ./backend/services/compliance-service
      dockerfile: Dockerfile
    container_name: mnbara-compliance-service
    ports:
      - "3015:3015"
    environment:
      - NODE_ENV=development
      - PORT=3015
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/compliance_db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3015/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Settlement Service - P2P Transfers & Local Settlement Matching
  settlement-service:
    build:
      context: ./backend/services/settlement-service
      dockerfile: Dockerfile
    container_name: mnbara-settlement-service
    ports:
      - "3016:3016"
    environment:
      - NODE_ENV=development
      - PORT=3016
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/settlement_db
      - REDIS_URL=redis://redis:6379
      - RABBITMQ_URL=amqp://mnbara:mnbara_dev_password@rabbitmq:5672
    depends_on:
      - postgres
      - redis
      - rabbitmq
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3016/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # UI Config Service - Dynamic UI Management
  ui-config-service:
    build:
      context: ./backend/services/ui-config-service
      dockerfile: Dockerfile
    container_name: mnbara-ui-config-service
    ports:
      - "3020:3020"
    environment:
      - NODE_ENV=development
      - PORT=3020
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/mnbara?schema=ui_config
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
      - ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3021,http://localhost:8080
    depends_on:
      - postgres
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3020/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # UI Config Dashboard - Vue.js Admin Panel
  ui-config-dashboard:
    build:
      context: ./frontend/ui-config-dashboard
      dockerfile: Dockerfile
    container_name: mnbara-ui-config-dashboard
    ports:
      - "3021:80"
    environment:
      - VITE_API_URL=http://localhost:3020/api/v1
    depends_on:
      - ui-config-service
    networks:
      - mnbara-network

  # ===================
  # Q1 2026 FINTECH SERVICES
  # ===================

  # BNPL Service - Buy Now Pay Later
  bnpl-service:
    build:
      context: ./backend/services/bnpl-service
      dockerfile: Dockerfile
    container_name: mnbara-bnpl-service
    ports:
      - "3017:3017"
    environment:
      - NODE_ENV=development
      - PORT=3017
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/bnpl_db
      - REDIS_URL=redis://redis:6379
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY:-sk_test_your_stripe_secret_key}
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3017/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Crypto Service - Bitcoin, Ethereum, USDC, USDT
  crypto-service:
    build:
      context: ./backend/services/crypto-service
      dockerfile: Dockerfile
    container_name: mnbara-crypto-service
    ports:
      - "3018:3018"
    environment:
      - NODE_ENV=development
      - PORT=3018
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/crypto_db
      - REDIS_URL=redis://redis:6379
      - COINBASE_API_KEY=${COINBASE_API_KEY:-your-coinbase-api-key}
      - ETH_NODE_URL=${ETH_NODE_URL:-https://mainnet.infura.io/v3/your-project-id}
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3018/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Multi-Currency Wallet Service
  wallet-service:
    build:
      context: ./backend/services/wallet-service
      dockerfile: Dockerfile
    container_name: mnbara-wallet-service
    ports:
      - "3019:3019"
    environment:
      - NODE_ENV=development
      - PORT=3019
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/wallet_db
      - REDIS_URL=redis://redis:6379
      - OPENEXCHANGERATES_API_KEY=${OPENEXCHANGERATES_API_KEY:-your-api-key}
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3019/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Escrow Service - Secure Payment Protection
  escrow-service:
    build:
      context: ./backend/services/escrow-service
      dockerfile: Dockerfile
    container_name: mnbara-escrow-service
    ports:
      - "3022:3022"
    environment:
      - NODE_ENV=development
      - PORT=3022
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/escrow_db
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3022/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # PayPal Service - PayPal Payment Integration
  paypal-service:
    build:
      context: ./backend/services/paypal-service
      dockerfile: Dockerfile
    container_name: mnbara-paypal-service
    ports:
      - "3023:3023"
    environment:
      - NODE_ENV=development
      - PORT=3023
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/paypal_db
      - REDIS_URL=redis://redis:6379
      - PAYPAL_MODE=sandbox
      - PAYPAL_CLIENT_ID=${PAYPAL_CLIENT_ID:-your-paypal-client-id}
      - PAYPAL_CLIENT_SECRET=${PAYPAL_CLIENT_SECRET:-your-paypal-client-secret}
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3023/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # AI Assistant Service - Gen 10 AI (Chat, Recommendations, Fraud Detection, Forecasting, Price Optimization)
  ai-assistant-service:
    build:
      context: ./backend/services/ai-assistant-service
      dockerfile: Dockerfile
    container_name: mnbara-ai-assistant-service
    ports:
      - "3024:3024"
    environment:
      - NODE_ENV=development
      - PORT=3024
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/ai_assistant_db
      - REDIS_URL=redis://redis:6379
      - OPENAI_API_KEY=${OPENAI_API_KEY:-your-openai-api-key}
      - PINECONE_API_KEY=${PINECONE_API_KEY:-your-pinecone-api-key}
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3024/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Mnbara AI Engine - Custom AI like Siri (Open Source Models)
  mnbara-ai-engine:
    build:
      context: ./backend/services/mnbara-ai-engine
      dockerfile: Dockerfile
    container_name: mnbara-ai-engine
    ports:
      - "3025:3025"
    environment:
      - NODE_ENV=development
      - PORT=3025
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/mnbara_ai_db
      - REDIS_URL=redis://redis:6379
      - HUGGINGFACE_API_KEY=${HUGGINGFACE_API_KEY:-your-huggingface-api-key}
      - DEFAULT_LLM_MODEL=mistral-7b
      - ENABLE_VOICE=true
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3025/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Wholesale Service - B2B Marketplace (Q2 2026)
  wholesale-service:
    build:
      context: ./backend/services/wholesale-service
      dockerfile: Dockerfile
    container_name: wholesale-service
    ports:
      - "3026:3026"
    environment:
      - NODE_ENV=development
      - PORT=3026
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/wholesale_db
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
      - AUTH_SERVICE_URL=http://auth-service:3001
      - PAYMENT_SERVICE_URL=http://payment-service:3003
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3026/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Smart Delivery Service - AI Route Optimization (Q2 2026)
  smart-delivery-service:
    build:
      context: ./backend/services/smart-delivery-service
      dockerfile: Dockerfile
    container_name: smart-delivery-service
    ports:
      - "3027:3027"
    environment:
      - NODE_ENV=development
      - PORT=3027
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/delivery_db
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
      - GOOGLE_MAPS_API_KEY=${GOOGLE_MAPS_API_KEY:-your-google-maps-key}
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3027/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Feature Management Service - Feature Flags & Release Management (Q2 2026)
  feature-management-service:
    build:
      context: ./backend/services/feature-management-service
      dockerfile: Dockerfile
    container_name: feature-management-service
    ports:
      - "3028:3028"
    environment:
      - NODE_ENV=development
      - PORT=3028
      - DATABASE_URL=postgresql://mnbara:mnbara_dev_password@postgres:5432/feature_db
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production-256-bit-key-for-security
      - ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3021,http://localhost:8080
    depends_on:
      - postgres
      - redis
    networks:
      - mnbara-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3028/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ===================
  # FRONTENDS
  # ===================

  web-app:
    build:
      context: ./frontend/web
      dockerfile: Dockerfile
    container_name: mnbara-web-app
    ports:
      - "3000:3000"
    environment:
      - VITE_API_URL=http://localhost:8080/api
    depends_on:
      - api-gateway
    networks:
      - mnbara-network

  admin-dashboard:
    build:
      context: ./frontend/admin-dashboard
      dockerfile: Dockerfile
    container_name: mnbara-admin-dashboard
    ports:
      - "3001:3000"
    environment:
      - VITE_API_URL=http://localhost:8080/api
    depends_on:
      - api-gateway
    networks:
      - mnbara-network

  # ===================
  # MONITORING
  # ===================

  prometheus:
    image: prom/prometheus:latest
    container_name: mnbara-prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    networks:
      - mnbara-network

  grafana:
    image: grafana/grafana:latest
    container_name: mnbara-grafana
    ports:
      - "3002:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana_data:/var/lib/grafana
    depends_on:
      - prometheus
    networks:
      - mnbara-network

networks:
  mnbara-network:
    driver: bridge

volumes:
  postgres_data:
  redis_data:
  rabbitmq_data:
  elasticsearch_data:
  prometheus_data:
  grafana_data:
  listing_uploads: