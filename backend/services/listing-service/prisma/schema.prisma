// Listing Service Database Schema
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  id          String @id @default(cuid())
  name        String
  slug        String @unique
  description String?
  icon        String?
  image       String?
  parentId    String?
  level       Int    @default(0)
  sortOrder   Int    @default(0)
  isActive    Boolean @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  parent      Category? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")
  products    Product[]
  
  @@map("categories")
}

model Product {
  id            String @id @default(cuid())
  title         String
  slug          String @unique
  description   String?
  shortDescription String?
  
  // Pricing
  price         Decimal @db.Decimal(10, 2)
  comparePrice  Decimal? @db.Decimal(10, 2)
  costPrice     Decimal? @db.Decimal(10, 2)
  currency      String @default("USD")
  
  // Inventory
  sku           String? @unique
  barcode       String?
  trackQuantity Boolean @default(true)
  quantity      Int @default(0)
  lowStockThreshold Int @default(5)
  
  // Physical properties
  weight        Decimal? @db.Decimal(8, 3)
  dimensions    Json? // {length, width, height}
  
  // SEO & Marketing
  metaTitle     String?
  metaDescription String?
  tags          String[]
  
  // Status
  status        ProductStatus @default(DRAFT)
  visibility    ProductVisibility @default(VISIBLE)
  featured      Boolean @default(false)
  
  // Timestamps
  publishedAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?
  
  // Foreign Keys
  categoryId    String
  sellerId      String
  
  // Relations
  category      Category @relation(fields: [categoryId], references: [id])
  images        ProductImage[]
  variants      ProductVariant[]
  attributes    ProductAttribute[]
  reviews       ProductReview[]
  listings      Listing[]
  
  @@map("products")
}

model ProductImage {
  id        String @id @default(cuid())
  productId String
  url       String
  altText   String?
  sortOrder Int @default(0)
  isPrimary Boolean @default(false)
  
  createdAt DateTime @default(now())
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@map("product_images")
}

model ProductVariant {
  id        String @id @default(cuid())
  productId String
  title     String
  price     Decimal? @db.Decimal(10, 2)
  sku       String? @unique
  barcode   String?
  quantity  Int @default(0)
  weight    Decimal? @db.Decimal(8, 3)
  
  // Variant options (color, size, etc.)
  options   Json // {color: "red", size: "L"}
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@map("product_variants")
}

model ProductAttribute {
  id        String @id @default(cuid())
  productId String
  name      String
  value     String
  type      AttributeType @default(TEXT)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@unique([productId, name])
  @@map("product_attributes")
}

model ProductReview {
  id        String @id @default(cuid())
  productId String
  userId    String
  rating    Int // 1-5
  title     String?
  comment   String?
  verified  Boolean @default(false)
  helpful   Int @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@map("product_reviews")
}

model Listing {
  id          String @id @default(cuid())
  productId   String
  sellerId    String
  title       String
  description String?
  
  // Pricing
  price       Decimal @db.Decimal(10, 2)
  currency    String @default("USD")
  
  // Availability
  quantity    Int @default(1)
  condition   ProductCondition @default(NEW)
  
  // Location
  location    Json? // {country, state, city, coordinates}
  
  // Shipping
  shippingOptions Json? // Array of shipping options
  
  // Status
  status      ListingStatus @default(ACTIVE)
  featured    Boolean @default(false)
  
  // Timestamps
  expiresAt   DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?
  
  // Relations
  product Product @relation(fields: [productId], references: [id])
  
  @@map("listings")
}

// Enums
enum ProductStatus {
  DRAFT
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum ProductVisibility {
  VISIBLE
  HIDDEN
  PRIVATE
}

enum AttributeType {
  TEXT
  NUMBER
  BOOLEAN
  DATE
  URL
  EMAIL
}

enum ProductCondition {
  NEW
  LIKE_NEW
  GOOD
  FAIR
  POOR
}

enum ListingStatus {
  DRAFT
  ACTIVE
  INACTIVE
  SOLD
  EXPIRED
  SUSPENDED
}